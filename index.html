<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jogo da Mem√≥ria Digital - In√≠cio</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- Overlay de Login -->
  <div id="loginOverlay" class="login-overlay" style="display: flex;">
    <div class="login-card">
      <div class="login-header">
        <div class="login-icon">üéÆ</div>
        <h2>Bem-vindo ao Jogo da Mem√≥ria!</h2>
        <p>Digite seu nome para come√ßar a jogar</p>
      </div>
      
      <form id="loginForm" class="login-form">
        <div class="input-group">
          <label for="playerName">Seu Nome:</label>
          <input 
            type="text" 
            id="playerName" 
            placeholder="Ex: Jo√£o Silva" 
            maxlength="20"
            required
            autocomplete="off"
          >
          <div class="input-hint">M√°x. 20 caracteres</div>
        </div>
        
        <div class="login-actions">
          <button type="submit" class="btn btn-primary">
            üöÄ Come√ßar a Jogar
          </button>
        </div>
        
        <div class="login-features">
          <div class="feature">
            <span>‚≠ê</span>
            <span>Hist√≥rico individual</span>
          </div>
          <div class="feature">
            <span>üèÜ</span>
            <span>Ranking global</span>
          </div>
          <div class="feature">
            <span>üìä</span>
            <span>Estat√≠sticas detalhadas</span>
          </div>
        </div>
      </form>
    </div>
  </div>

  <main class="container" role="main" style="display: none;">
    <section class="start-card" role="region" aria-labelledby="titulo-jogo">

      <!-- LOGO E T√çTULO -->
      <div class="brand" aria-hidden="false">
        <figure class="logo" aria-hidden="true">
          <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Logotipo Jogo da Mem√≥ria Digital">
            <rect x="6" y="6" width="88" height="88" rx="12" fill="#0F1724" opacity="0.06"/>
            <g transform="translate(10,10)" stroke="#0F1724" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
              <rect x="0" y="0" width="40" height="40" rx="6" fill="#7DD3FC"/>
              <rect x="46" y="0" width="40" height="40" rx="6" fill="#FB7185"/>
              <rect x="0" y="46" width="40" height="40" rx="6" fill="#FDE68A"/>
              <rect x="46" y="46" width="40" height="40" rx="6" fill="#34D399"/>
            </g>
          </svg>
        </figure>

        <div>
          <h1 id="titulo-jogo">Jogo da Mem√≥ria Digital</h1>
          <p class="lead">Memorize, combine pares e ven√ßa o tabuleiro ‚Äî simples, r√°pido e divertido.</p>
          <div class="player-welcome" id="playerWelcome">
            <!-- Nome do jogador ser√° inserido aqui -->
          </div>
        </div>
      </div>

      <!-- BOT√ïES -->
      <div class="actions" aria-hidden="false">
        <button id="startBtn" class="btn btn-primary" aria-describedby="instrucoes" title="Iniciar Jogo">üéÆ Iniciar</button>
        <button id="historyBtn" class="btn btn-secondary" aria-label="Ver hist√≥rico de partidas">üìä Meu Hist√≥rico</button>
        <button id="rankingBtn" class="btn btn-warning" aria-label="Ver ranking global">üèÜ Ranking Global</button>
        <button id="howBtn" class="btn btn-ghost" aria-expanded="false" aria-controls="instrucoes">‚ùì Como Jogar</button>
      </div>

      <!-- INSTRU√á√ïES -->
      <div id="instrucoes" class="instructions" role="region" aria-labelledby="label-instrucoes">
        <div style="flex:1;">
          <h2 id="label-instrucoes" style="font-size:15px;margin:0 0 8px 0;">Instru√ß√µes r√°pidas</h2>
          <div class="steps" id="stepsList">
            <div class="step">
              <span class="dot" aria-hidden="true"></span>
              <div><strong>Objetivo:</strong> Encontrar todos os pares virando duas cartas por vez.</div>
            </div>
            <div class="step">
              <span class="dot" aria-hidden="true"></span>
              <div><strong>Pontua√ß√£o:</strong> Menos tentativas aumentam sua pontua√ß√£o.</div>
            </div>
            <div class="step">
              <span class="dot" aria-hidden="true"></span>
              <div><strong>N√≠veis:</strong> Selecione dificuldade depois de iniciar (F√°cil/M√©dio/Dif√≠cil).</div>
            </div>
            <div class="step">
              <span class="dot" aria-hidden="true"></span>
              <div><strong>Ranking:</strong> Compita com outros jogadores no ranking global.</div>
            </div>
          </div>

          <footer class="meta" aria-hidden="false">
            <span>Tempo estimado de partida: 2‚Äì5 minutos</span>
            <span>Vers√£o: 2.0</span>
          </footer>
        </div>
      </div>
    </section>
  </main>

  <!-- JAVASCRIPT DA TELA INICIAL -->
  <script>
    // JavaScript para tela inicial - ATUALIZADO COM LOGIN E RANKING
    const loginOverlay = document.getElementById('loginOverlay');
    const loginForm = document.getElementById('loginForm');
    const playerNameInput = document.getElementById('playerName');
    const mainContainer = document.querySelector('main');
    const playerWelcome = document.getElementById('playerWelcome');
    
    const startBtn = document.getElementById('startBtn');
    const historyBtn = document.getElementById('historyBtn');
    const rankingBtn = document.getElementById('rankingBtn');
    const howBtn = document.getElementById('howBtn');

    // ‚úÖ SISTEMA DE LOGIN
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const playerName = playerNameInput.value.trim();
      
      if (!playerName) {
        showNotification('Por favor, digite seu nome!', 'error');
        return;
      }
      
      if (playerName.length > 20) {
        showNotification('O nome deve ter no m√°ximo 20 caracteres!', 'error');
        return;
      }
      
      // Salvar nome do jogador
      localStorage.setItem('memoryGamePlayer', playerName);
      
      // Mostrar mensagem de boas-vindas
      playerWelcome.innerHTML = `
        <div class="welcome-message">
          üëã Ol√°, <strong>${playerName}</strong>!
        </div>
      `;
      
      // Transi√ß√£o para a tela principal
      loginOverlay.style.opacity = '0';
      setTimeout(() => {
        loginOverlay.style.display = 'none';
        mainContainer.style.display = 'block';
      }, 500);
    });

    // ‚úÖ VERIFICAR SE J√Å EXISTE UM JOGADOR
    window.addEventListener('DOMContentLoaded', () => {
      const savedPlayer = localStorage.getItem('memoryGamePlayer');
      if (savedPlayer) {
        loginOverlay.style.display = 'none';
        mainContainer.style.display = 'block';
        playerWelcome.innerHTML = `
          <div class="welcome-message">
            üëã Ol√°, <strong>${savedPlayer}</strong>!
          </div>
        `;
      }
    });

    // Bot√£o "Iniciar": redireciona para o tabuleiro
    startBtn.addEventListener('click', () => {
      window.location.href = 'game.html';
    });

    // Bot√£o "Meu Hist√≥rico": mostra hist√≥rico individual
    historyBtn.addEventListener('click', () => {
      showIndividualHistory();
    });

    // Bot√£o "Ranking Global": mostra ranking global
    rankingBtn.addEventListener('click', () => {
      showGlobalRanking();
    });

    // Bot√£o "Como Jogar": rola suavemente at√© as instru√ß√µes
    howBtn.addEventListener('click', () => {
      const instrucoes = document.getElementById('instrucoes');
      instrucoes.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    // ‚úÖ FUN√á√ÉO PARA MOSTRAR HIST√ìRICO INDIVIDUAL
    function showIndividualHistory() {
      try {
        const playerName = localStorage.getItem('memoryGamePlayer');
        const history = JSON.parse(localStorage.getItem('memoryGameHistory') || '[]');
        const playerHistory = history.filter(game => game.playerName === playerName);
        
        const historyHTML = `
          <div class="history-overlay">
            <div class="history-card">
              <div class="history-header">
                <h2>üìä Meu Hist√≥rico - ${playerName}</h2>
                <button class="btn-close" onclick="closeHistory()" aria-label="Fechar hist√≥rico">
                  √ó
                </button>
              </div>
              
              <div class="history-content">
                ${playerHistory.length === 0 ? 
                  '<div class="empty-history">üéØ Nenhuma partida registrada ainda.<br><br>Jogue uma partida para ver seu hist√≥rico!</div>' : 
                  generateHistoryList(playerHistory, true)
                }
              </div>
              
              <div class="history-actions">
                ${playerHistory.length > 0 ? 
                  `<button onclick="clearIndividualHistory()" class="btn btn-danger">
                    üóëÔ∏è Limpar Meu Hist√≥rico
                  </button>` : 
                  ''
                }
                <button onclick="closeHistory()" class="btn btn-ghost">
                  Fechar
                </button>
              </div>
            </div>
          </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', historyHTML);
      } catch (error) {
        console.error('Erro ao carregar hist√≥rico:', error);
        alert('Erro ao carregar hist√≥rico de partidas.');
      }
    }

    // ‚úÖ FUN√á√ÉO PARA MOSTRAR RANKING GLOBAL
    function showGlobalRanking() {
      try {
        const globalRanking = JSON.parse(localStorage.getItem('memoryGameGlobalRanking') || '[]');
        const currentPlayer = localStorage.getItem('memoryGamePlayer');
        
        const rankingHTML = `
          <div class="ranking-overlay">
            <div class="ranking-card">
              <div class="ranking-header">
                <h2>üèÜ Ranking Global</h2>
                <button class="btn-close" onclick="closeRanking()" aria-label="Fechar ranking">
                  √ó
                </button>
              </div>
              
              <div class="ranking-content">
                ${globalRanking.length === 0 ? 
                  '<div class="empty-ranking">üéØ Nenhuma pontua√ß√£o no ranking ainda.<br><br>Seja o primeiro a entrar no ranking!</div>' : 
                  generateRankingList(globalRanking, currentPlayer)
                }
              </div>
              
              <div class="ranking-stats">
                <div class="stat">
                  <span class="stat-value">${globalRanking.length}</span>
                  <span class="stat-label">Jogadores</span>
                </div>
                <div class="stat">
                  <span class="stat-value">${globalRanking[0]?.score || 0}</span>
                  <span class="stat-label">Recorde</span>
                </div>
                <div class="stat">
                  <span class="stat-value">${getPlayerRank(globalRanking, currentPlayer) || '-'}</span>
                  <span class="stat-label">Sua Posi√ß√£o</span>
                </div>
              </div>
              
              <div class="ranking-actions">
                <button onclick="closeRanking()" class="btn btn-ghost">
                  Fechar
                </button>
              </div>
            </div>
          </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', rankingHTML);
      } catch (error) {
        console.error('Erro ao carregar ranking:', error);
        alert('Erro ao carregar ranking global.');
      }
    }

    // ‚úÖ FUN√á√ïES AUXILIARES
    function generateHistoryList(history, showPlayer = false) {
      return `
        <div class="history-list">
          ${history.map((game, index) => `
            <div class="history-item ${index === 0 ? 'recent' : ''}">
              <div class="history-game-info">
                <div class="game-main-stats">
                  <span class="game-score">${game.score} pts</span>
                  <span class="game-difficulty badge-${game.difficulty}">${getDifficultyName(game.difficulty)}</span>
                </div>
                <div class="game-details">
                  <span>${game.moves} jogadas</span>
                  <span>‚Ä¢</span>
                  <span>${game.time}</span>
                  <span>‚Ä¢</span>
                  <span>${game.efficiency}% efici√™ncia</span>
                </div>
                <div class="game-date">
                  ${formatDate(game.date)}
                </div>
              </div>
              <div class="history-rank">
                #${index + 1}
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function generateRankingList(ranking, currentPlayer) {
      return `
        <div class="ranking-list">
          ${ranking.slice(0, 20).map((player, index) => `
            <div class="ranking-item ${player.playerName === currentPlayer ? 'current-player' : ''} ${index < 3 ? `top-${index + 1}` : ''}">
              <div class="ranking-position">
                ${getRankingMedal(index + 1)}
              </div>
              <div class="ranking-player-info">
                <div class="player-name">
                  ${player.playerName}
                  ${player.playerName === currentPlayer ? '<span class="you-badge">Voc√™</span>' : ''}
                </div>
                <div class="player-stats">
                  <span>${player.score} pontos</span>
                  <span>‚Ä¢</span>
                  <span>${getDifficultyName(player.difficulty)}</span>
                  <span>‚Ä¢</span>
                  <span>${player.moves} jogadas</span>
                </div>
              </div>
              <div class="ranking-score">
                ${player.score}
                <span>pts</span>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function getRankingMedal(position) {
      switch(position) {
        case 1: return 'ü•á';
        case 2: return 'ü•à';
        case 3: return 'ü•â';
        default: return `#${position}`;
      }
    }

    function getPlayerRank(ranking, playerName) {
      const playerIndex = ranking.findIndex(player => player.playerName === playerName);
      return playerIndex !== -1 ? playerIndex + 1 : null;
    }

    function getDifficultyName(difficulty) {
      const names = { 
        easy: 'F√°cil', 
        medium: 'M√©dio', 
        hard: 'Dif√≠cil' 
      };
      return names[difficulty] || difficulty;
    }

    function formatDate(dateString) {
      try {
        const date = new Date(dateString);
        return date.toLocaleDateString('pt-BR', {
          day: '2-digit', 
          month: '2-digit', 
          year: 'numeric',
          hour: '2-digit', 
          minute: '2-digit'
        });
      } catch (error) {
        return 'Data inv√°lida';
      }
    }

    function closeHistory() {
      const historyOverlay = document.querySelector('.history-overlay');
      if (historyOverlay) historyOverlay.remove();
    }

    function closeRanking() {
      const rankingOverlay = document.querySelector('.ranking-overlay');
      if (rankingOverlay) rankingOverlay.remove();
    }

    function clearIndividualHistory() {
      if (confirm('Tem certeza que deseja limpar seu hist√≥rico individual?\n\nEsta a√ß√£o n√£o pode ser desfeita.')) {
        try {
          const playerName = localStorage.getItem('memoryGamePlayer');
          const globalHistory = JSON.parse(localStorage.getItem('memoryGameHistory') || '[]');
          const filteredHistory = globalHistory.filter(game => game.playerName !== playerName);
          
          localStorage.setItem('memoryGameHistory', JSON.stringify(filteredHistory));
          closeHistory();
          showNotification('Seu hist√≥rico foi limpo!');
          setTimeout(showIndividualHistory, 500);
        } catch (error) {
          alert('Erro ao limpar hist√≥rico.');
        }
      }
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--accent)'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        z-index: 3000;
        animation: slideInRight 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => {
          if (notification.parentNode) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Acessibilidade
    document.addEventListener('keydown', (e) => {
      if ((e.key === 'Enter' || e.key === ' ') && document.activeElement === startBtn) {
        e.preventDefault();
        startBtn.click();
      }
    });

    // CSS din√¢mico
    const style = document.createElement('style');
    style.textContent = `
      .btn-warning {
        background: var(--warning);
        color: white;
        border: none;
      }
      
      .btn-warning:hover {
        background: #e69500;
        transform: translateY(-1px);
      }
      
      .welcome-message {
        background: var(--glass);
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 0.9rem;
        margin-top: 8px;
        display: inline-block;
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>